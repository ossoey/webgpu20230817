<!--
   Copyright (c) 2013-2023 Ossoey/experiments. 
   All rights reserved.
-->
<!-- About Us page for Ossoey segmentation website -->

<!-- Authored by ebanga@ossoey.com/ebanga@hotmail.com -->

<!DOCTYPE html> 
<html>
    <head>
        <title>Webgpu</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous"/>       
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.8/xlsx.full.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.2/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.2/vfs_fonts.js"></script>
        
        <style>
            :root {

            --padding-right-left:20vw;   
            --header-padding:5px var(--padding-right-left);
            --padding-right-left-querymedia:2vw;  
            --header-padding-querymedia:5px var(--padding-right-left-querymedia);
            --header-margin: 0 2vh;

            --main-head-color: #505050de;
            --main-body--color: #ffffff;
            --main-font-family: Arial, Helvetica, sans-serif;
            --main-font-color: black;
            --main-line-color: rgba(0, 217, 255, 0.787);
            --main-padding:5px 10vw;

            --table-head-color:rgba(54, 37, 4, 0.787);
            --table-body-color1:rgba(0, 217, 255, 0.787);
            --table-alternate-color2:rgb(255, 209, 73);
            --table-font-family: Arial, Helvetica, sans-serif;
            --table-font-color:rgba(54, 37, 4, 0.787);
            
            --h1-font-size: 24px;
            --h2-font-size: 20px;
            } 

            *{
                margin: 0; 
                padding: 0;
                box-sizing: border-box;  
            }

            #header-id{
                padding:var( --header-padding);
            }

            #logo-menu-id{
                display: flex;
                justify-content: space-between;
            }

            #menu-button-id{
                cursor: pointer;
            }

            .menu-subbutton {
                width: 20px;
                height: 2px;
                background-color:var( --main-line-color); 
                margin: 2px;
            }

            nav{
                display: flex;
                justify-content: end;
            }

            #menu-id{
                position: absolute;
                top: 20px;
                right:var(--padding-right-left);
                display: none;
            }

            .nav-item{
                cursor: pointer;
                border: 2px var(--table-body-color1) solid;
                margin: 3px 0;
            }



            #main-id{
                display: flex;
                justify-content: center;
            }


            #home-id{
                padding:var( --header-padding);
             
            }

            .home-menu-item{
                cursor: pointer;
                margin: 3px 0;
                border: 2px var(--table-body-color1) solid;
            }






            .fielsetclass {
                border: none;
                margin-bottom: 20px;
                border-top: 2px var(--table-body-color1) solid;
            }

             legend {
                margin: 5px 0;
              
            }

            .containerinputframe{
                display: grid;
                grid-template-columns: repeat(3, 1fr); /* Three equal-sized columns */
                grid-gap: 3px; /* Adjust the gap between items */
              
            }

            .inputtext{
                padding: 4px 6px;
                margin: 0 8px;
            }

            .inputlabel{
              
                margin: 0 8px;
            }

            .containsubmitbutton{
                display: grid;
                grid-template-columns: repeat(3, 1fr); /* Three equal-sized columns */
                grid-gap: 3px; /* Adjust the gap between items */
              
            }

            .submitbutton{
                border: 2px var(--table-alternate-color2) solid;
                background-color: var(--main-head-color);
                cursor: pointer;
                padding: 5px 7px;
            }

            .table-striped tbody tr:nth-child(even) {
                background-color:var(--table-body-color1);
            }
            .table-striped tbody tr:nth-child(odd) {
                background-color:var(--table-alternate-color2);
            }


   


            #footer-id{
                padding:var( --header-padding);
            }

           @media (max-width:900px) {
                #header-id{
                    padding:var(    --header-padding-querymedia );
                }

                #menu-id{
 
                    right:var(--padding-right-left-querymedia);
 
                }

                #home-id{
                    padding:var(    --header-padding-querymedia );
                }

                #footer-id{
                    padding:var(  --header-padding-querymedia );
                }

                .containerinputframe{
                    display: block;
                }

           }         

        </style>

    </head>
    <body>

        <div id="header-id"> 

            <div id="logo-menu-id">
                <div id="logo-frame-id">
                    <div id="logo-id"> <h1>Webgpu</h1></div>
                    <div id="module-id"> <h2>Vector Addition</h2></div>
                </div> 
                <div id="menu-button-id">
                    <div class="menu-subbutton"></div>
                    <div class="menu-subbutton"></div>
                    <div class="menu-subbutton"></div>
                </div>
            </div>
            <nav>
                <div id="menu-id">
                    <div class="nav-item">Vector addition</div>
                    <div class="nav-item">Dot product</div>
                    <div class="nav-item">Magnitude</div>
                    <div class="nav-item">Distance</div>  
                    <div class="nav-item" id="homepage-id"> <a href="index.html">Home</a></div>  
                </div>
            </nav>
        </div>

        <div id="main-id">

            <form id="vector-addition-id">
                
                <fieldset id="fieldsetinput-id" class="fielsetclass">
                    <legend><h4> Input &nbsp;</h4></legend>
                    <div class="containerinputframe" >
                        <div class="inputframe">
                            <div class="inputlabel">Vector1</div>
                            <input type="text" name="" id="vector1" class="inputtext">   
                        </div>
        
                        <div class="inputframe">
                            <div class="inputlabel">Vector2</div>
                            <input type="text" name="" id="vector2" class="inputtext">   
                        </div>    

                        <div> <canvas> </canvas></div>
                    </div>
                </fieldset>

                <fieldset id="fieldsetsubmit-id" class="fielsetclass">
                    <legend> <h4> Submit  &nbsp;</h4></legend>
                    <div  class="containsubmitbutton">
                        <button class="submitbutton" id="run">Run</button>
        
                        <button class="submitbutton" id="clear">Clear</button>    
                    </div>
                </fieldset>

                <fieldset id="fieldsetresult-id" class="fielsetclass">
                    <legend><h4> Output  &nbsp; </h4></legend>
                    <div  id="tableframe-id">
                        <table  class="table-striped">
                          <thead>
                            <tr>
                              <th>Column 1</th>
                              <th>Column 2</th>
                              <th>Column 3</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Row 1, Column 1</td>
                              <td>Row 1, Column 2</td>
                              <td>Row 1, Column 3</td>
                            </tr>
                            <tr>
                              <td>Row 2, Column 1</td>
                              <td>Row 2, Column 2</td>
                              <td>Row 2, Column 3</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                </fieldset>


               
            </form>

        </div>
        
        <div id="footer-id">
            <h3> webgpu.Ossoey.com &#169;Copyright 2023 </h3>
        </div>  

        <script  type="module" >
             const menu_button = document.getElementById('menu-button-id');
             const menu_id = document.getElementById('menu-id');

             menu_button.addEventListener('click', () => {
             if (menu_id.style.display === 'block') {
                 menu_id.style.display = 'none'; // Hide the element
             } else {
                
                 menu_id.style.display = 'block'; // Display the element
             }
             });

            // const run = document.getElementById('run');

            // run.addEventListener('click', () => {
     
            // });


             // wgsl language
             // type

    
             async function main() {
  const adapter = await navigator.gpu?.requestAdapter();
  const device = await adapter?.requestDevice();
  if (!device) {
    fail('need a browser that supports WebGPU');
    return;
  }

  // Get a WebGPU context from the canvas and configure it
  const canvas = document.querySelector('canvas');
  const context = canvas.getContext('webgpu');
  const presentationFormat = navigator.gpu.getPreferredCanvasFormat();
  context.configure({
    device,
    format: presentationFormat,
      });


  let pointCount =  12*30;   
  let size = 0.6;

  const module = device.createShaderModule({
    label: 'our hardcoded red triangle shaders',
    code: `
      
         const pointscount = ${pointCount};
         const base = 12;


        fn reTriangle(vertexindex:u32, center:vec2f,size:f32, subSize:f32 )->vec2f{
            
            var arr: array<vec2f,pointscount>;
              
              const lessthan = pointscount/base;
              var sz = size;
              for (var i = 0; i < lessthan; i++) {
                      arr[0+12*i] = vec2f(center[0]-subSize*sz,center[1]+  subSize*sz);
                      arr[1+12*i] = vec2f(center[0],center[1]+ 1.0*sz); 
                      arr[2+12*i] = vec2f(center[0]+ subSize*sz,center[1] + subSize*sz);
  
                      arr[3+12*i] = vec2f(center[0]+ subSize*sz, center[1] + subSize*sz);
                      arr[4+12*i] = vec2f(center[0] + 1.0*sz, center[1]);
                      arr[5+12*i] = vec2f(center[0]+ subSize*sz, center[1]-subSize*sz);
  
                      arr[6+12*i] = vec2f( center[0]-subSize*sz, center[1]-subSize*sz);
                      arr[7+12*i] = vec2f(center[0], center[1]-1.0*sz);
                      arr[8+12*i] = vec2f( center[0]+subSize*sz, center[1]-subSize*sz);
  
                      arr[9+12*i] = vec2f(center[0]-subSize*sz,  center[1]+subSize*sz);
                      arr[10+12*i] = vec2f( center[0]-1.0*sz,  center[1]);
                      arr[11+12*i] = vec2f( center[0]-subSize*sz,  center[1]-subSize*sz) ;
  
                      sz = sz*subSize;
              }
  

            return arr[vertexindex];
        }

   

      @vertex fn vs(
        @builtin(vertex_index) vertexIndex : u32
      ) -> @builtin(position) vec4f {
        

        return vec4f(reTriangle(vertexIndex, vec2f(0,0),${size },0.95) , 0.0, 1.0);

      }

      @fragment fn fs() -> @location(0) vec4f {
        return vec4f(1, 0, 0, 1);
      }
    `,
  });

  const pipeline = device.createRenderPipeline({
    label: 'our hardcoded red triangle pipeline',
    layout: 'auto',
    vertex: {
      module,
      entryPoint: 'vs',
    },
    fragment: {
      module,
      entryPoint: 'fs',
      targets: [{ format: presentationFormat }],
    },
  });

  const renderPassDescriptor = {
    label: 'our basic canvas renderPass',
    colorAttachments: [
      {
        // view: <- to be filled out when we render
        clearValue: [0.3, 0.3, 0.3, 1],
        loadOp: 'clear',
        storeOp: 'store',
      },
    ],
  };

  function render() {
    // Get the current texture from the canvas context and
    // set it as the texture to render to.
    renderPassDescriptor.colorAttachments[0].view =
        context.getCurrentTexture().createView();

    // make a command encoder to start encoding commands
    const encoder = device.createCommandEncoder({ label: 'our encoder' });

    // make a render pass encoder to encode render specific commands
    const pass = encoder.beginRenderPass(renderPassDescriptor);
    pass.setPipeline(pipeline);
    pass.draw(pointCount);  // call our vertex shader 3 times.
    pass.end();

    const commandBuffer = encoder.finish();
    device.queue.submit([commandBuffer]);
  }

  render();
}

function fail(msg) {
  // eslint-disable-next-line no-alert
  alert(msg);
}

main();



        </script>

    </body>

</html>