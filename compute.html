<!--
   Copyright (c) 2013-2023 Ossoey/experiments. 
   All rights reserved.
-->
<!-- About Us page for Ossoey segmentation website -->

<!-- Authored by ebanga@ossoey.com/ebanga@hotmail.com -->

<!DOCTYPE html> 
<html>
    <head>
        <title>Webgpu</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous"/>       
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.8/xlsx.full.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.2/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.2/vfs_fonts.js"></script>
        
        <style>
            :root {

            --padding-right-left:20vw;   
            --header-padding:5px var(--padding-right-left);
            --padding-right-left-querymedia:2vw;  
            --header-padding-querymedia:5px var(--padding-right-left-querymedia);
            --header-margin: 0 2vh;

            --main-head-color: #505050de;
            --main-body--color: #ffffff;
            --main-font-family: Arial, Helvetica, sans-serif;
            --main-font-color: black;
            --main-line-color: rgba(0, 217, 255, 0.787);
            --main-padding:5px 10vw;

            --table-head-color:rgba(54, 37, 4, 0.787);
            --table-body-color1:rgba(0, 217, 255, 0.787);
            --table-alternate-color2:rgb(255, 209, 73);
            --table-font-family: Arial, Helvetica, sans-serif;
            --table-font-color:rgba(54, 37, 4, 0.787);
            
            --h1-font-size: 24px;
            --h2-font-size: 20px;
            } 

            *{
                margin: 0; 
                padding: 0;
                box-sizing: border-box;  
            }

            #header-id{
                padding:var( --header-padding);
            }

            #logo-menu-id{
                display: flex;
                justify-content: space-between;
            }

            #menu-button-id{
                cursor: pointer;
            }

            .menu-subbutton {
                width: 20px;
                height: 2px;
                background-color:var( --main-line-color); 
                margin: 2px;
            }

            nav{
                display: flex;
                justify-content: end;
            }

            #menu-id{
                position: absolute;
                top: 20px;
                right:var(--padding-right-left);
                display: none;
            }

            .nav-item{
                cursor: pointer;
                border: 2px var(--table-body-color1) solid;
                margin: 3px 0;
            }



            #main-id{
                display: flex;
                justify-content: center;
            }


            #home-id{
                padding:var( --header-padding);
             
            }

            .home-menu-item{
                cursor: pointer;
                margin: 3px 0;
                border: 2px var(--table-body-color1) solid;
            }






            .fielsetclass {
                border: none;
                margin-bottom: 20px;
                border-top: 2px var(--table-body-color1) solid;
            }

             legend {
                margin: 5px 0;
              
            }

            .containerinputframe{
                display: grid;
                grid-template-columns: repeat(3, 1fr); /* Three equal-sized columns */
                grid-gap: 3px; /* Adjust the gap between items */
              
            }

            .inputtext{
                padding: 4px 6px;
                margin: 0 8px;
            }

            .inputlabel{
              
                margin: 0 8px;
            }

            .containsubmitbutton{
                display: grid;
                grid-template-columns: repeat(3, 1fr); /* Three equal-sized columns */
                grid-gap: 3px; /* Adjust the gap between items */
              
            }

            .submitbutton{
                border: 2px var(--table-alternate-color2) solid;
                background-color: var(--main-head-color);
                cursor: pointer;
                padding: 5px 7px;
            }

            .table-striped tbody tr:nth-child(even) {
                background-color:var(--table-body-color1);
            }
            .table-striped tbody tr:nth-child(odd) {
                background-color:var(--table-alternate-color2);
            }


   


            #footer-id{
                padding:var( --header-padding);
            }

           @media (max-width:900px) {
                #header-id{
                    padding:var(    --header-padding-querymedia );
                }

                #menu-id{
 
                    right:var(--padding-right-left-querymedia);
 
                }

                #home-id{
                    padding:var(    --header-padding-querymedia );
                }

                #footer-id{
                    padding:var(  --header-padding-querymedia );
                }

                .containerinputframe{
                    display: block;
                }

           }         

        </style>

    </head>
    <body>

        <div id="header-id"> 

            <div id="logo-menu-id">
                <div id="logo-frame-id">
                    <div id="logo-id"> <h1>Webgpu</h1></div>
                    <div id="module-id"> <h2>Compute</h2></div>
                </div> 
                <div id="menu-button-id">
                    <div class="menu-subbutton"></div>
                    <div class="menu-subbutton"></div>
                    <div class="menu-subbutton"></div>
                </div>
            </div>
            <nav>
                <div id="menu-id">
                    <div class="nav-item">Vector addition</div>
                    <div class="nav-item">Dot product</div>
                    <div class="nav-item">Magnitude</div>
                    <div class="nav-item">Distance</div>  
                    <div class="nav-item" id="homepage-id"> <a href="index.html">Home</a></div>  
                </div>
            </nav>
        </div>

        <div id="main-id">

            <form id="vector-addition-id">
                
                <fieldset id="fieldsetinput-id" class="fielsetclass">
                    <legend><h4> Input &nbsp;</h4></legend>
                    <div class="containerinputframe" >
                              <div> <canvas> </canvas></div>
                    </div>
                </fieldset>

                <fieldset id="fieldsetsubmit-id" class="fielsetclass">
                    <legend> <h4> Submit  &nbsp;</h4></legend>
                    <div  class="containsubmitbutton">
                        <button class="submitbutton" id="run">Run</button>
        
                        <button class="submitbutton" id="clear">Clear</button>    
                    </div>
                </fieldset>

                <fieldset id="fieldsetresult-id" class="fielsetclass">
                    <legend><h4> Output  &nbsp; </h4></legend>
                    <div  id="tableframe-id">
                        <table  class="table-striped">
                          <thead>
                            <tr>
                              <th>Column 1</th>
                              <th>Column 2</th>
                              <th>Column 3</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Row 1, Column 1</td>
                              <td>Row 1, Column 2</td>
                              <td>Row 1, Column 3</td>
                            </tr>
                            <tr>
                              <td>Row 2, Column 1</td>
                              <td>Row 2, Column 2</td>
                              <td>Row 2, Column 3</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                </fieldset>


               
            </form>

        </div>
        
        <div id="footer-id">
            <h3> webgpu.Ossoey.com &#169;Copyright 2023 </h3>
        </div>  

        <script  type="module" >
             const menu_button = document.getElementById('menu-button-id');
             const menu_id = document.getElementById('menu-id');

             menu_button.addEventListener('click', () => {
             if (menu_id.style.display === 'block') {
                 menu_id.style.display = 'none'; // Hide the element
             } else {
                
                 menu_id.style.display = 'block'; // Display the element
             }
             });

            // const run = document.getElementById('run');

            // run.addEventListener('click', () => {
     
            // });


             // wgsl language
             // type

  async function main() {

    const adapter = await navigator.gpu.requestAdapter();
    if(!adapter){
        alert(`This browser is not support webgpu`);
        return;
    }

    const device = await adapter.requestDevice();
    if(!device){
        alert(`Not able to request device!`);
        return;
    }

    const shaderModule = device.createShaderModule({
        label:`Shader Module for computation`, 
        code:`
        
          @group(0) @binding(0) var<storage, read_write> data : array<f32>;

          @compute @workgroup_size(1) fn computeSomething(@builtin(global_invocation_id) id: vec3u){
             var i = id.x;
             data[i] = data[i]*2.0;
          }
        `

    });

    const pipeline = device.createComputePipeline({
        label: `pipeline for computation`, 
        layout: `auto`, 
        compute : {
            entryPoint:`computeSomething`, 
            module: shaderModule
        }
    });

    const dataInput = new Float32Array([3,5,6]);

    const bufferInput = device.createBuffer({
        size: dataInput.byteLength, 
        usage: GPUBufferUsage.STORAGE| GPUBufferUsage.COPY_SRC| GPUBufferUsage.COPY_DST
    });

    device.queue.writeBuffer(bufferInput,0, dataInput);


    const bufferOutput = device.createBuffer({
        size: dataInput.byteLength, 
        usage: GPUBufferUsage.MAP_READ| GPUBufferUsage.COPY_DST
    });

    const bindGroup = device.createBindGroup({
        label: `bindGroup for computation`, 
        layout: pipeline.getBindGroupLayout(0),
        entries:[
            {binding:0, resource:{buffer: bufferInput}}
        ]
    });


    const cmdEncoder = device.createCommandEncoder({
        label: `cmdEncoder for computation`, 
    });

    const pass = cmdEncoder.beginComputePass();
    pass.setPipeline(pipeline);
    pass.setBindGroup(0, bindGroup);
    pass.dispatchWorkgroups(dataInput.length);
    pass.end();

    cmdEncoder.copyBufferToBuffer(bufferInput,0, bufferOutput, 0, bufferOutput.size);

    device.queue.submit([cmdEncoder.finish()]);


    await bufferOutput.mapAsync(GPUMapMode.READ);
    const result = new Float32Array(bufferOutput.getMappedRange().slice());
    bufferOutput.unmap();

    console.log(result, ``,dataInput);



    


   }

  main();
  
   </script>

    </body>

</html>